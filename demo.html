<!DOCTYPE html>
<html lang="ja" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="./base.css">
  <style media="screen">
    body {
      margin: 0;
    }
    .bottom {
      position: fixed;
      bottom: 10px;
      background: white;
      left: 20px;
    }
    .box { border: 1px solid gray; height: 60px; width: 80%; margin: 50px auto; background: gray; }
  </style>
</head>

<body>
  <div id="main-content" class="stackpage show" style="font-size: 30px; background:lightblue; height: 3000px">
    <div class="box stackpage-to" data-page-to="page2">
      open stackpage2
    </div>
  </div>

  <div id="page2" class="stackpage">
    this is page2
    <div class="box stackpage-to" data-page-to="main-content">back</div>
    <div class="scrollable">
      <div class="box stackpage-to2" data-page-to="page3">Lorem</div>
      <div class="box stackpage-to2" data-page-to="page3">ipsum</div>
      <div class="box stackpage-to2" data-page-to="page3">dolor</div>
      <div class="box stackpage-to2" data-page-to="page3">sit</div>
      <div class="box stackpage-to2" data-page-to="page3">amet</div>
      <div class="box stackpage-to2" data-page-to="page3">consectetur</div>
      <div class="box stackpage-to2" data-page-to="page3">adipisicing</div>
      <div class="box stackpage-to2" data-page-to="page3">elit,</div>
      <div class="box stackpage-to2" data-page-to="page3">sed</div>
      <div class="box stackpage-to2" data-page-to="page3">do</div>
      <div class="box stackpage-to2" data-page-to="page3">eiusmod</div>
    </div>
  </div>

  <div id="page3" class="stackpage">
    <div id="page3-title">
      PAGE3
    </div>
    <div class="box stackpage-to" data-page-to="page2">
      back
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="  crossorigin="anonymous"></script>
  <script type="module">
  import PageStack from './index.js';
  const ps = new PageStack({
    baseId: 'main-content',
  });

  $('.stackpage-to').on('click', (e) => {
    const id = $(e.target).data('page-to');
    ps.to(id);
    window.history.pushState({ id }, '');
  });

  $('.stackpage-to2').on('click', (e) => {
    const id = $(e.target).data('page-to');
    ps.to(id);
    window.history.pushState({ id }, '');
    const title = e.target.innerHTML;
    document.getElementById('page3-title').innerText = title;
  });

  window.history.pushState({ id: 'main-content' }, '');
  window.onpopstate = ({ state }) => {
    if (state && state.id) {
      ps.to(state.id);
    }
  };
  </script>
</body>

</html>
